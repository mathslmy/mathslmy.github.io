<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>æ™ºèƒ½åª’ä½“åŠ©æ‰‹ - è½»é‡ç‰ˆ</title>
  <!-- æ’ä»¶æ ·å¼ -->
  <link rel="stylesheet" href="https://mathslmy.github.io/style.css">
</head>
<body>
  <div class="smart-media-assistant">

    <!-- å›¾ç‰‡å¤„ç† -->
    <section class="smart-media-section">
      <h3>ğŸ–¼ï¸ å›¾ç‰‡å¤„ç†</h3>
      <div class="smart-media-drop-zone" id="image-drop-zone">
        <div class="icon">ğŸ“·</div>
        <div class="text">æ‹–æ‹½æˆ–ç‚¹å‡»ä¸Šä¼ å›¾ç‰‡</div>
        <div class="subtext">æ”¯æŒ JPG/PNG/WebPï¼Œè‡ªåŠ¨å‹ç¼©ä¼˜åŒ–</div>
        <input type="file" id="image-input" accept="image/*" hidden>
      </div>
      <div id="image-preview"></div>
    </section>

    <!-- æ–‡æ¡£å¤„ç† -->
    <section class="smart-media-section">
      <h3>ğŸ“„ æ–‡æ¡£å¤„ç†</h3>
      <div class="smart-media-drop-zone" id="document-drop-zone">
        <div class="icon">ğŸ“‚</div>
        <div class="text">æ‹–æ‹½æˆ–ç‚¹å‡»ä¸Šä¼ æ–‡æ¡£</div>
        <div class="subtext">æ”¯æŒ TXT/JSON/CSV/MD ç­‰</div>
        <input type="file" id="document-input" hidden>
      </div>
      <div id="document-preview"></div>
    </section>

    <!-- API è®¾ç½® -->
    <section class="smart-media-section">
      <h3>âš™ï¸ API è°ƒç”¨</h3>
      <div class="smart-media-settings">
        <div class="smart-media-setting-group">
          <label class="smart-media-setting-label">æ¨¡å‹ API åœ°å€</label>
          <input type="text" id="api-url" class="smart-media-setting-input" placeholder="https://api.openai.com/v1/chat/completions">
        </div>
        <div class="smart-media-setting-group">
          <label class="smart-media-setting-label">API å¯†é’¥</label>
          <input type="password" id="api-key" class="smart-media-setting-input" placeholder="sk-xxxxxxxx">
        </div>
        <button id="btn-save-api" class="btn-small btn-process">ä¿å­˜è®¾ç½®</button>
      </div>
      <button id="btn-test-api" class="btn-small btn-process" style="margin-top:10px;">æµ‹è¯•è°ƒç”¨æ¨¡å‹</button>
      <pre id="api-result"></pre>
    </section>

  </div>

  <!-- æ’ä»¶é€»è¾‘ -->
  <script src="https://mathslmy.github.io/index.js"></script>

  <!-- é¡µé¢ç»‘å®šé€»è¾‘ -->
  <script>
    // å›¾ç‰‡ä¸Šä¼ 
    document.getElementById('image-drop-zone').addEventListener('click', () => {
      document.getElementById('image-input').click();
    });
    document.getElementById('image-input').addEventListener('change', async (e) => {
      const file = e.target.files[0];
      if (file) {
        const result = await window.__uploadImageByPlugin(file);
        document.getElementById('image-preview').innerText =
          `å›¾ç‰‡å·²å¤„ç†:\n${JSON.stringify(result.metadata, null, 2)}`;
      }
    });

    // æ–‡æ¡£ä¸Šä¼ 
    document.getElementById('document-drop-zone').addEventListener('click', () => {
      document.getElementById('document-input').click();
    });
    document.getElementById('document-input').addEventListener('change', async (e) => {
      const file = e.target.files[0];
      if (file) {
        const result = await window.__processDocumentByPlugin(file);
        document.getElementById('document-preview').innerText =
          `æ–‡æ¡£å·²å¤„ç†:\n${JSON.stringify(result.metadata, null, 2)}`;
      }
    });

    // API è®¾ç½®
    function saveApiSettings() {
      const url = document.getElementById('api-url').value;
      const key = document.getElementById('api-key').value;
      localStorage.setItem('smartMediaApiUrl', url);
      localStorage.setItem('smartMediaApiKey', key);
      alert('âœ… API è®¾ç½®å·²ä¿å­˜');
    }
    function loadApiSettings() {
      document.getElementById('api-url').value = localStorage.getItem('smartMediaApiUrl') || '';
      document.getElementById('api-key').value = localStorage.getItem('smartMediaApiKey') || '';
    }
    document.getElementById('btn-save-api').addEventListener('click', saveApiSettings);
    loadApiSettings();

    // API æµ‹è¯•è°ƒç”¨
    document.getElementById('btn-test-api').addEventListener('click', async () => {
      const url = localStorage.getItem('smartMediaApiUrl');
      const key = localStorage.getItem('smartMediaApiKey');
      if (!url || !key) {
        alert('è¯·å…ˆè®¾ç½® API åœ°å€å’Œå¯†é’¥');
        return;
      }
      try {
        const response = await fetch(url, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${key}`
          },
          body: JSON.stringify({
            model: "gpt-3.5-turbo",
            messages: [{ role: "user", content: "ä½ å¥½ï¼Œè¯·ç®€å•ä»‹ç»ä¸€ä¸‹è‡ªå·±ã€‚" }]
          })
        });
        const data = await response.json();
        document.getElementById('api-result').innerText = JSON.stringify(data, null, 2);
      } catch (err) {
        document.getElementById('api-result').innerText = `âŒ è°ƒç”¨å¤±è´¥: ${err.message}`;
      }
    });
  </script>
</body>
</html>
